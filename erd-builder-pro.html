<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ERD Builder Pro</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.4.21/vue.global.prod.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
  <style>
    [v-cloak]{display:none}
    .entity-card{min-width:240px}
    .grid-bg{background-image:linear-gradient(#e5e7eb 1px,transparent 1px),linear-gradient(90deg,#e5e7eb 1px,transparent 1px);background-size:20px 20px}
    .attr-row:hover{background-color:#f3f4f6}
    .attr-row:hover .attr-actions{opacity:1}
    .attr-row:hover .drag-handle{opacity:1}
    .attr-actions{opacity:0;transition:opacity .15s}
    .badge{font-size:9px;padding:1px 3px;border-radius:2px;margin-left:2px}
    .tooltip{position:absolute;background:#1f2937;color:#fff;padding:6px 10px;border-radius:4px;font-size:11px;z-index:100;bottom:100%;left:50%;transform:translateX(-50%);margin-bottom:6px;white-space:pre-line;max-width:220px}
    .tooltip::after{content:'';position:absolute;top:100%;left:50%;margin-left:-4px;border-width:4px;border-style:solid;border-color:#1f2937 transparent transparent}
    .modal-input{width:100%;border:1px solid #d1d5db;border-radius:4px;padding:6px 8px;font-size:12px}
    .modal-input:focus{outline:none;border-color:#3b82f6}
    .modal-label{font-size:11px;color:#6b7280;margin-bottom:2px;display:block}
    .modal-section{margin-bottom:12px}
    .toggle-btn{padding:4px 8px;border-radius:4px;font-size:11px;cursor:pointer;transition:all .15s;font-weight:500;position:relative}
    .toggle-on{background:#dbeafe;color:#1d4ed8;border:1px solid #93c5fd}
    .toggle-off{background:#f3f4f6;color:#6b7280;border:1px solid #d1d5db}
    .toggle-tooltip{position:absolute;bottom:100%;left:50%;transform:translateX(-50%);background:#1f2937;color:#fff;padding:4px 8px;border-radius:4px;font-size:10px;white-space:nowrap;margin-bottom:6px;opacity:0;pointer-events:none;transition:opacity .15s;font-weight:normal}
    .toggle-tooltip::after{content:'';position:absolute;top:100%;left:50%;margin-left:-4px;border-width:4px;border-style:solid;border-color:#1f2937 transparent transparent}
    .toggle-btn:hover .toggle-tooltip{opacity:1}
    .color-preset{width:24px;height:24px;border-radius:4px;cursor:pointer;border:2px solid transparent}
    .color-preset.selected{border-color:#1f2937;box-shadow:0 0 0 2px #fff,0 0 0 4px #3b82f6}
    .entity-type-card{border:1px solid #e5e7eb;border-radius:6px;padding:6px 10px;cursor:pointer;font-size:12px}
    .entity-type-card:hover{border-color:#93c5fd;background:#f0f9ff}
    .entity-type-card.selected{border-color:#3b82f6;background:#dbeafe}
    .relation-item{display:flex;align-items:center;justify-content:space-between;padding:8px 10px;border:1px solid #e5e7eb;border-radius:6px;margin-bottom:6px;font-size:12px}
    .relation-item.pending-delete{background:#fef2f2;border-color:#fecaca;opacity:0.7}
    .relation-item.pending-add{background:#f0fdf4;border-color:#bbf7d0}
    .tab-btn{padding:8px 16px;font-size:12px;border-bottom:2px solid transparent;cursor:pointer}
    .tab-btn.active{border-color:#3b82f6;color:#3b82f6;font-weight:500}
    .key-icon{font-size:10px;font-weight:bold;padding:1px 4px;border-radius:3px}
    .pk-icon{background:#fef3c7;color:#92400e}
    .fk-icon{background:#dbeafe;color:#1e40af}
    .pending-badge{font-size:9px;padding:2px 6px;border-radius:10px;margin-left:8px}
    .lang-btn{padding:2px 8px;border-radius:4px;font-size:11px;cursor:pointer}
    .lang-btn.active{background:rgba(255,255,255,0.3)}
    .drag-handle{opacity:0;cursor:grab;padding:0 4px;color:#9ca3af;transition:opacity .15s;user-select:none}
    .drag-handle:hover{color:#6b7280}
    .drag-handle:active{cursor:grabbing}
    .attr-row.dragging{background:#dbeafe;box-shadow:0 2px 8px rgba(59,130,246,0.3);z-index:10;position:relative}
    .attr-row.dragging .drag-handle{opacity:1;color:#3b82f6}
    .attr-row{transition:transform 0.15s ease,background 0.15s ease}
  </style>
</head>
<body class="bg-gray-100">
<div id="app" v-cloak class="h-screen flex flex-col text-sm">
  <div class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-4 py-3 flex items-center justify-between">
    <span class="font-bold">ERD Builder Pro</span>
    <div class="flex gap-2 items-center">
      <div class="flex border border-white border-opacity-30 rounded overflow-hidden mr-2">
        <button @click="lang='ko'" :class="['lang-btn',lang==='ko'?'active':'']">한국어</button>
        <button @click="lang='en'" :class="['lang-btn',lang==='en'?'active':'']">EN</button>
      </div>
      <button @click="colorSettingsModal=true" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-3 py-1.5 rounded text-xs">{{t.colorSettings}}</button>
      <label class="flex items-center gap-1 text-xs cursor-pointer"><input type="checkbox" v-model="showBadges"> {{t.badge}}</label>
      <button @click="showSQL=true" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-3 py-1.5 rounded text-xs">{{t.viewSql}}</button>
    </div>
  </div>

  <div class="flex flex-1 overflow-hidden">
    <div class="w-52 bg-white border-r flex flex-col">
      <div class="p-3 border-b">
        <button @click="openEntityModal()" class="w-full bg-blue-500 text-white py-2 rounded text-xs hover:bg-blue-600">+ {{t.addEntity}}</button>
      </div>
      <div class="flex-1 overflow-y-auto p-2">
        <div v-for="entity in entities" :key="entity.id" :class="['border rounded p-2 mb-2 cursor-pointer',selectedEntityId===entity.id?'border-blue-500 bg-blue-50':'hover:bg-gray-50']" @click="selectedEntityId=entity.id" @dblclick="openEntityModal(entity)">
          <div class="flex items-center gap-2">
            <span class="w-3 h-3 rounded" :style="{background:entity.color}"></span>
            <span class="font-medium text-gray-800 text-xs">{{entity.name}}</span>
          </div>
          <div class="text-xs text-gray-400 mt-1 ml-5">{{getEntityTypeName(entity.entityType)}}</div>
        </div>
      </div>
    </div>

    <div ref="canvas" class="flex-1 overflow-auto bg-gray-50 relative grid-bg" @mousemove="onMouseMove" @mouseup="onMouseUp" @mouseleave="onMouseUp" style="min-height:600px">
      <svg class="absolute inset-0 w-full h-full pointer-events-none" style="min-width:1400px;min-height:900px">
        <g v-for="rel in relations" :key="'l'+rel.id">
          <path :d="getRelationPath(rel)" stroke="#6366f1" stroke-width="2" fill="none"/>
          <path v-for="(p,i) in getCrowsFoot(rel,'from')" :key="'f'+i" :d="p" stroke="#6366f1" stroke-width="2" fill="none"/>
          <path v-for="(p,i) in getCrowsFoot(rel,'to')" :key="'t'+i" :d="p" stroke="#6366f1" stroke-width="2" fill="none"/>
        </g>
      </svg>

      <div v-for="entity in entities" :key="'c'+entity.id" :class="['absolute bg-white border-2 rounded-lg shadow-lg select-none entity-card',selectedEntityId===entity.id?'border-blue-500':'border-gray-300']" :style="{left:entity.x+'px',top:entity.y+'px'}" @click.stop="selectedEntityId=entity.id">
        <div class="text-white px-3 py-2 rounded-t-md text-xs flex items-center justify-between cursor-move" :style="{background:entity.color}" @mousedown="onMouseDown($event,entity)">
          <span @dblclick.stop="openEntityModal(entity)">{{entity.name}}</span>
          <div class="flex items-center gap-1">
            <button @click.stop="openEntityModal(entity)" class="hover:bg-white hover:bg-opacity-20 rounded px-1">{{t.settings}}</button>
            <button @click.stop="addAttr(entity.id)" class="hover:bg-white hover:bg-opacity-20 rounded px-1">+</button>
          </div>
        </div>
        <div class="divide-y text-xs">
          <div v-for="(attr,attrIdx) in entity.attributes" :key="attr.id" 
               :class="['px-2 py-1.5 attr-row cursor-pointer relative', attrDrag.dragging&&attrDrag.sourceEntityId===entity.id&&attrDrag.draggedAttrId===attr.id?'dragging':'']"
               draggable="true"
               @click.stop="openAttrModal(entity.id,attr)" 
               @mouseenter="hoverAttr={eid:entity.id,aid:attr.id}" 
               @mouseleave="hoverAttr=null"
               @dragstart="onAttrDragStart($event,entity.id,attrIdx,attr.id)"
               @dragend="onAttrDragEnd"
               @dragover="onAttrDragOver($event,entity.id,attrIdx)"
               @drop="onAttrDrop">
            <div class="flex items-center gap-1">
              <span class="drag-handle" @mousedown.stop>⋮⋮</span>
              <span class="w-6 flex gap-0.5">
                <span v-if="attr.pk" class="key-icon pk-icon">PK</span>
                <span v-if="attr.fk" class="key-icon fk-icon">FK</span>
              </span>
              <span :class="{'font-bold':attr.pk}" class="flex-1 truncate">{{attr.name}}</span>
              <span class="text-gray-400 truncate text-right">{{getTypeDisplay(attr)}}</span>
              <div class="attr-actions ml-1"><button @click.stop="deleteAttr(entity.id,attr.id)" class="text-red-400 hover:text-red-600">×</button></div>
            </div>
            <div v-if="showBadges&&(attr.nn||attr.unique||attr.autoIncrement||attr.unsigned)" class="flex flex-wrap gap-1 mt-1 ml-6">
              <span v-if="attr.unsigned" class="badge bg-purple-100 text-purple-700">UN</span>
              <span v-if="attr.nn" class="badge bg-orange-100 text-orange-700">NN</span>
              <span v-if="attr.unique" class="badge bg-green-100 text-green-700">UQ</span>
              <span v-if="attr.autoIncrement" class="badge bg-pink-100 text-pink-700">AI</span>
            </div>
            <div v-if="hoverAttr?.eid===entity.id&&hoverAttr?.aid===attr.id&&!attrDrag.dragging" class="tooltip">
              <div><b>{{attr.name}}</b> {{getTypeDisplay(attr)}}</div>
              <div v-if="attr.fkRef?.table">→ {{attr.fkRef.table}}.{{attr.fkRef.column}}</div>
              <div v-if="attr.comment">{{attr.comment}}</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div v-if="entityModal.show" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click="closeEntityModal">
    <div class="bg-white rounded-lg w-full max-w-xl" @click.stop style="max-height:90vh;display:flex;flex-direction:column">
      <div class="flex justify-between items-center px-5 pt-4 pb-2">
        <span class="font-bold text-gray-800">{{entityModal.isEdit?t.editEntity:t.newEntity}}</span>
        <button @click="closeEntityModal" class="text-gray-400 hover:text-gray-600 text-xl">&times;</button>
      </div>
      <div class="flex border-b px-5">
        <div @click="entityModal.tab='basic'" :class="['tab-btn',entityModal.tab==='basic'?'active':'text-gray-500']">{{t.basicInfo}}</div>
        <div v-if="entityModal.isEdit" @click="entityModal.tab='relations'" :class="['tab-btn',entityModal.tab==='relations'?'active':'text-gray-500']">{{t.relationSettings}}<span v-if="hasPendingChanges()" class="pending-badge bg-orange-100 text-orange-600">{{t.changed}}</span></div>
      </div>
      <div class="flex-1 overflow-y-auto p-5">
        <div v-if="entityModal.tab==='basic'">
          <div class="modal-section"><label class="modal-label">{{t.entityName}} *</label><input v-model="entityModal.data.name" class="modal-input" :placeholder="t.tableName"></div>
          <div class="modal-section"><label class="modal-label">{{t.entityType}}</label>
            <div class="grid grid-cols-4 gap-2 mt-2">
              <div v-for="tp in entityTypes" :key="tp.id" @click="selectEntityType(tp)" :class="['entity-type-card text-center',entityModal.data.entityType===tp.id?'selected':'']">
                <div class="w-4 h-4 rounded mx-auto mb-1" :style="{background:tp.color}"></div><div>{{tp.name[lang]}}</div>
              </div>
            </div>
          </div>
          <div class="modal-section"><label class="modal-label">{{t.headerColor}}</label>
            <div class="flex items-center gap-2 mt-2">
              <div v-for="c in colorPalette" :key="c" @click="entityModal.data.color=c" :class="['color-preset',entityModal.data.color===c?'selected':'']" :style="{background:c}"></div>
              <input type="color" v-model="entityModal.data.color" class="w-6 h-6 rounded cursor-pointer border-0 ml-2">
            </div>
          </div>
          <div class="modal-section"><label class="modal-label">{{t.description}}</label><textarea v-model="entityModal.data.description" class="modal-input h-14 resize-none" :placeholder="t.tableDesc"></textarea></div>
        </div>
        <div v-if="entityModal.tab==='relations'">
          <div class="modal-section"><label class="modal-label">{{t.currentRelations}}</label>
            <div v-if="pendingRelations.existing.length===0&&pendingRelations.toAdd.length===0" class="text-xs text-gray-400 py-3 text-center border rounded mt-2">{{t.noRelations}}</div>
            <div v-else class="mt-2">
              <div v-for="rel in pendingRelations.existing" :key="'e'+rel.id" :class="['relation-item',pendingRelations.toDelete.includes(rel.id)?'pending-delete':'']">
                <div class="flex items-center gap-2"><span :class="rel.from===entityModal.editId?'text-blue-600 font-medium':'text-gray-600'">{{getEntityNameSafe(rel.from)}}</span><span class="px-2 py-0.5 bg-indigo-100 text-indigo-700 rounded text-xs">{{rel.cardinality}}</span><span :class="rel.to===entityModal.editId?'text-blue-600 font-medium':'text-gray-600'">{{getEntityNameSafe(rel.to)}}</span><span v-if="pendingRelations.toDelete.includes(rel.id)" class="pending-badge bg-red-100 text-red-600">{{t.pendingDelete}}</span></div>
                <button v-if="!pendingRelations.toDelete.includes(rel.id)" @click="markRelationForDelete(rel.id)" class="text-red-400 hover:text-red-600 text-sm">{{t.delete}}</button>
                <button v-else @click="unmarkRelationForDelete(rel.id)" class="text-blue-500 hover:text-blue-700 text-sm">{{t.cancel}}</button>
              </div>
              <div v-for="(rel,idx) in pendingRelations.toAdd" :key="'a'+idx" class="relation-item pending-add">
                <div class="flex items-center gap-2"><span :class="rel.fromId===entityModal.editId?'text-blue-600 font-medium':'text-gray-600'">{{getEntityNameSafe(rel.fromId)}}</span><span class="px-2 py-0.5 bg-indigo-100 text-indigo-700 rounded text-xs">{{rel.cardinality}}</span><span :class="rel.toId===entityModal.editId?'text-blue-600 font-medium':'text-gray-600'">{{getEntityNameSafe(rel.toId)}}</span><span class="pending-badge bg-green-100 text-green-600">{{t.pendingAdd}}</span></div>
                <button @click="removePendingRelation(idx)" class="text-red-400 hover:text-red-600 text-sm">{{t.cancel}}</button>
              </div>
            </div>
          </div>
          <div class="modal-section border-t pt-4 mt-4"><label class="modal-label">{{t.addNewRelation}}</label>
            <div class="mt-3 p-3 bg-gray-50 rounded-lg">
              <div class="flex items-center gap-2 mb-3">
                <label class="flex items-center gap-2 cursor-pointer"><input type="radio" v-model="newRel.direction" value="from"><span class="text-xs">{{t.thisToOther}}</span></label>
                <label class="flex items-center gap-2 cursor-pointer ml-4"><input type="radio" v-model="newRel.direction" value="to"><span class="text-xs">{{t.otherToThis}}</span></label>
              </div>
              <div class="grid grid-cols-3 gap-2 mb-3">
                <div><label class="modal-label">{{t.targetEntity}}</label><select v-model="newRel.targetId" class="modal-input" @change="onTargetChange"><option value="">{{t.select}}...</option><option v-for="e in getOtherEntities()" :key="e.id" :value="e.id">{{e.name}}</option></select></div>
                <div><label class="modal-label">{{t.cardinality}}</label><select v-model="newRel.cardinality" class="modal-input" @change="onTargetChange"><option value="1:1">1:1</option><option value="1:N">1:N</option><option value="N:1">N:1</option><option value="N:M">N:M</option></select></div>
                <div><label class="modal-label">{{t.relationName}}</label><input v-model="newRel.label" class="modal-input" :placeholder="t.optional"></div>
              </div>
              <div v-if="newRel.targetId" class="border-t pt-3 mt-3"><label class="modal-label">{{t.fkColumnSettings}}</label>
                <div class="bg-white border rounded p-3">
                  <div class="flex items-center justify-between mb-2"><span class="text-xs font-medium">{{t.fkTargetTable}}:</span><span class="text-xs text-blue-600 font-medium">{{getFkTargetTableName()}}</span></div>
                  <div class="grid grid-cols-2 gap-2 mb-2">
                    <div><label class="modal-label">{{t.fkColumnName}}</label><input v-model="newRel.fkColumnName" class="modal-input" :placeholder="getDefaultFkColumnName()"></div>
                    <div><label class="modal-label">{{t.refColumn}}</label><select v-model="newRel.refColumn" class="modal-input"><option v-for="col in getRefColumns()" :key="col.id" :value="col.name">{{col.name}} ({{col.type}})</option></select></div>
                  </div>
                  <div class="flex items-center gap-4 mb-2"><label class="flex items-center gap-2 text-xs cursor-pointer"><input type="checkbox" v-model="newRel.fkNullable">{{t.allowNull}}</label></div>
                  <div class="p-2 bg-gray-50 rounded text-xs text-gray-600">{{t.preview}}: <span class="font-medium">{{getFkTargetTableName()}}</span>.<span class="text-blue-600">{{newRel.fkColumnName||getDefaultFkColumnName()}}</span> → <span class="font-medium">{{getRefTableName()}}</span>.<span class="text-green-600">{{newRel.refColumn}}</span><span v-if="newRel.fkNullable" class="text-orange-500 ml-1">(NULLABLE)</span></div>
                </div>
              </div>
              <button @click="addPendingRelation" :disabled="!newRel.targetId||!newRel.refColumn" :class="['w-full py-2 rounded text-xs text-white mt-3',newRel.targetId&&newRel.refColumn?'bg-green-500 hover:bg-green-600':'bg-gray-300 cursor-not-allowed']">{{t.addRelation}}</button>
            </div>
          </div>
          <div v-if="hasPendingChanges()" class="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded text-xs text-yellow-800">{{t.pendingChangesMsg}}</div>
        </div>
      </div>
      <div class="flex justify-between p-4 border-t">
        <button v-if="entityModal.isEdit" @click="deleteEntityFromModal" class="px-3 py-2 text-sm text-red-600 hover:bg-red-50 rounded">{{t.deleteEntity}}</button><div v-else></div>
        <div class="flex gap-2"><button @click="closeEntityModal" class="px-4 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded">{{t.cancel}}</button><button @click="saveEntity" class="px-4 py-2 text-sm bg-blue-500 text-white rounded hover:bg-blue-600">{{entityModal.isEdit?t.save:t.create}}</button></div>
      </div>
    </div>
  </div>

  <div v-if="colorSettingsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click="colorSettingsModal=false">
    <div class="bg-white rounded-lg w-full max-w-md p-5" @click.stop>
      <div class="flex justify-between items-center mb-4"><span class="font-bold">{{t.entityTypeColor}}</span><button @click="colorSettingsModal=false" class="text-gray-400 text-xl">&times;</button></div>
      <div class="space-y-3">
        <div v-for="tp in entityTypes" :key="tp.id" class="flex items-center justify-between p-2 border rounded">
          <div class="flex items-center gap-2"><span class="w-5 h-5 rounded" :style="{background:tp.color}"></span><span class="text-sm">{{tp.name[lang]}}</span></div>
          <div class="flex items-center gap-1"><div v-for="c in colorPalette.slice(0,6)" :key="c" @click="tp.color=c" :class="['w-5 h-5 rounded cursor-pointer border',tp.color===c?'border-gray-800':'border-transparent']" :style="{background:c}"></div><input type="color" v-model="tp.color" class="w-5 h-5 rounded cursor-pointer border-0"></div>
        </div>
      </div>
    </div>
  </div>

  <div v-if="attrModal.show" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click="attrModal.show=false">
    <div class="bg-white rounded-lg w-full max-w-md p-4" @click.stop>
      <div class="flex justify-between items-center mb-4"><span class="font-bold">{{t.columnProperties}}</span><button @click="attrModal.show=false" class="text-gray-400 text-xl">&times;</button></div>
      <div class="grid grid-cols-2 gap-3">
        <div class="modal-section col-span-2"><label class="modal-label">{{t.columnName}}</label><input v-model="attrModal.data.name" class="modal-input"></div>
        <div class="modal-section"><label class="modal-label">{{t.type}}</label><select v-model="attrModal.data.type" class="modal-input"><optgroup :label="t.numbers"><option>TINYINT</option><option>SMALLINT</option><option>INT</option><option>BIGINT</option><option>DECIMAL</option><option>FLOAT</option><option>DOUBLE</option></optgroup><optgroup :label="t.strings"><option>CHAR</option><option>VARCHAR</option><option>TEXT</option><option>MEDIUMTEXT</option><option>LONGTEXT</option></optgroup><optgroup :label="t.datetime"><option>DATE</option><option>TIME</option><option>DATETIME</option><option>TIMESTAMP</option></optgroup><optgroup :label="t.others"><option>BOOLEAN</option><option>ENUM</option><option>JSON</option><option>BLOB</option></optgroup></select></div>
        <div class="modal-section"><label class="modal-label">{{t.length}}</label><input v-model="attrModal.data.length" class="modal-input" placeholder="255"></div>
        <div class="modal-section"><label class="modal-label">{{t.defaultValue}}</label><input v-model="attrModal.data.defaultValue" class="modal-input"></div>
        <div class="modal-section"><label class="modal-label">Charset</label><select v-model="attrModal.data.charset" class="modal-input"><option value="">-</option><option>utf8</option><option>utf8mb4</option></select></div>
        <div class="modal-section col-span-2"><label class="modal-label">{{t.constraints}}</label>
          <div class="flex flex-wrap gap-2 mt-1">
            <button @click="attrModal.data.pk=!attrModal.data.pk" :class="['toggle-btn',attrModal.data.pk?'toggle-on':'toggle-off']">PK<span class="toggle-tooltip">{{t.pkTooltip}}</span></button>
            <button @click="attrModal.data.fk=!attrModal.data.fk" :class="['toggle-btn',attrModal.data.fk?'toggle-on':'toggle-off']">FK<span class="toggle-tooltip">{{t.fkTooltip}}</span></button>
            <button @click="attrModal.data.nn=!attrModal.data.nn" :class="['toggle-btn',attrModal.data.nn?'toggle-on':'toggle-off']">NN<span class="toggle-tooltip">{{t.nnTooltip}}</span></button>
            <button @click="attrModal.data.unique=!attrModal.data.unique" :class="['toggle-btn',attrModal.data.unique?'toggle-on':'toggle-off']">UQ<span class="toggle-tooltip">{{t.uqTooltip}}</span></button>
            <button @click="attrModal.data.unsigned=!attrModal.data.unsigned" :class="['toggle-btn',attrModal.data.unsigned?'toggle-on':'toggle-off']">UN<span class="toggle-tooltip">{{t.unTooltip}}</span></button>
            <button @click="attrModal.data.autoIncrement=!attrModal.data.autoIncrement" :class="['toggle-btn',attrModal.data.autoIncrement?'toggle-on':'toggle-off']">AI<span class="toggle-tooltip">{{t.aiTooltip}}</span></button>
          </div>
        </div>
        <div v-if="attrModal.data.fk" class="modal-section col-span-2"><label class="modal-label">{{t.fkReference}}</label><div class="flex gap-2"><select v-model="attrModal.data.fkRef.table" class="modal-input"><option value="">{{t.table}}</option><option v-for="e in entities" :value="e.name">{{e.name}}</option></select><select v-model="attrModal.data.fkRef.column" class="modal-input"><option value="">{{t.column}}</option><option v-for="a in getFkRefColumns()" :value="a.name">{{a.name}}</option></select></div></div>
        <div class="modal-section col-span-2"><label class="modal-label">{{t.comment}}</label><textarea v-model="attrModal.data.comment" class="modal-input h-12 resize-none"></textarea></div>
      </div>
      <div class="flex justify-between mt-4"><button @click="deleteAttrFromModal" class="px-3 py-2 text-sm text-red-600 hover:bg-red-50 rounded">{{t.delete}}</button><div class="flex gap-2"><button @click="attrModal.show=false" class="px-4 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded">{{t.cancel}}</button><button @click="saveAttr" class="px-4 py-2 text-sm bg-blue-500 text-white rounded hover:bg-blue-600">{{t.save}}</button></div></div>
    </div>
  </div>

  <div v-if="showSQL" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click="showSQL=false">
    <div class="bg-white rounded-lg w-3/4 flex flex-col" style="max-height:85vh" @click.stop>
      <div class="flex justify-between items-center px-4 py-3 border-b"><span class="font-bold">SQL DDL</span><div class="flex items-center gap-4"><label class="flex items-center gap-1 text-xs"><input type="checkbox" v-model="sqlOptions.comments"> {{t.comment}}</label><button @click="showSQL=false" class="text-xl">&times;</button></div></div>
      <pre class="flex-1 overflow-auto p-4 bg-gray-900 text-green-400 text-xs font-mono whitespace-pre-wrap">{{generatedSQL}}</pre>
      <div class="p-3 border-t flex justify-end gap-2"><button @click="downloadSQL" class="bg-gray-500 text-white px-4 py-2 rounded text-sm">{{t.download}}</button><button @click="copySQL" class="bg-blue-500 text-white px-4 py-2 rounded text-sm">{{t.copy}}</button></div>
    </div>
  </div>
</div>

<script>
const{createApp,ref,computed,reactive}=Vue;
createApp({
  setup(){
    const lang=ref('ko');
    const translations={
      ko:{colorSettings:'색상 설정',badge:'뱃지',viewSql:'SQL 보기',addEntity:'엔티티 추가',settings:'설정',editEntity:'엔티티 편집',newEntity:'새 엔티티',basicInfo:'기본 정보',relationSettings:'관계 설정',changed:'변경됨',entityName:'엔티티명',tableName:'테이블명',entityType:'엔티티 타입',headerColor:'헤더 색상',description:'설명',tableDesc:'테이블 설명...',currentRelations:'현재 관계',noRelations:'설정된 관계가 없습니다',pendingDelete:'삭제 예정',pendingAdd:'추가 예정',delete:'삭제',cancel:'취소',addNewRelation:'새 관계 추가',thisToOther:'이 엔티티 → 다른 엔티티',otherToThis:'다른 엔티티 → 이 엔티티',targetEntity:'대상 엔티티',cardinality:'카디널리티',relationName:'관계명',optional:'선택',select:'선택',fkColumnSettings:'FK 컬럼 설정',fkTargetTable:'FK 컬럼 생성 테이블',fkColumnName:'FK 컬럼명',refColumn:'참조 컬럼',allowNull:'NULL 허용',preview:'미리보기',addRelation:'관계 추가',pendingChangesMsg:'변경사항이 있습니다. 저장 버튼을 눌러야 적용됩니다.',deleteEntity:'엔티티 삭제',save:'저장',create:'생성',entityTypeColor:'엔티티 타입 색상',columnProperties:'컬럼 속성',columnName:'컬럼명',type:'타입',length:'길이',defaultValue:'기본값',constraints:'제약조건',fkReference:'FK 참조',table:'테이블',column:'컬럼',comment:'코멘트',download:'다운로드',copy:'복사',numbers:'숫자',strings:'문자열',datetime:'날짜/시간',others:'기타',pkTooltip:'Primary Key: 테이블의 각 행을 고유하게 식별',fkTooltip:'Foreign Key: 다른 테이블의 PK를 참조',nnTooltip:'Not Null: NULL 값을 허용하지 않음',uqTooltip:'Unique: 중복 값을 허용하지 않음',unTooltip:'Unsigned: 음수를 허용하지 않음 (숫자 타입)',aiTooltip:'Auto Increment: 자동으로 증가하는 값'},
      en:{colorSettings:'Colors',badge:'Badge',viewSql:'View SQL',addEntity:'Add Entity',settings:'Settings',editEntity:'Edit Entity',newEntity:'New Entity',basicInfo:'Basic Info',relationSettings:'Relations',changed:'Changed',entityName:'Entity Name',tableName:'Table name',entityType:'Entity Type',headerColor:'Header Color',description:'Description',tableDesc:'Table description...',currentRelations:'Current Relations',noRelations:'No relations configured',pendingDelete:'To Delete',pendingAdd:'To Add',delete:'Delete',cancel:'Cancel',addNewRelation:'Add New Relation',thisToOther:'This Entity → Other Entity',otherToThis:'Other Entity → This Entity',targetEntity:'Target Entity',cardinality:'Cardinality',relationName:'Relation Name',optional:'Optional',select:'Select',fkColumnSettings:'FK Column Settings',fkTargetTable:'FK Column Target Table',fkColumnName:'FK Column Name',refColumn:'Reference Column',allowNull:'Allow NULL',preview:'Preview',addRelation:'Add Relation',pendingChangesMsg:'You have pending changes. Click Save to apply.',deleteEntity:'Delete Entity',save:'Save',create:'Create',entityTypeColor:'Entity Type Colors',columnProperties:'Column Properties',columnName:'Column Name',type:'Type',length:'Length',defaultValue:'Default',constraints:'Constraints',fkReference:'FK Reference',table:'Table',column:'Column',comment:'Comment',download:'Download',copy:'Copy',numbers:'Numbers',strings:'Strings',datetime:'Date/Time',others:'Others',pkTooltip:'Primary Key: Uniquely identifies each row',fkTooltip:'Foreign Key: References PK of another table',nnTooltip:'Not Null: Does not allow NULL values',uqTooltip:'Unique: Does not allow duplicate values',unTooltip:'Unsigned: No negative numbers (numeric types)',aiTooltip:'Auto Increment: Automatically incrementing value'}
    };
    const t=computed(()=>translations[lang.value]);
    const colorPalette=['#6366f1','#8b5cf6','#ec4899','#ef4444','#f97316','#eab308','#22c55e','#14b8a6','#06b6d4','#3b82f6','#64748b','#1f2937'];
    const entityTypes=ref([{id:'parent',name:{ko:'부모',en:'Parent'},color:'#6366f1'},{id:'child',name:{ko:'자식',en:'Child'},color:'#22c55e'},{id:'mapping',name:{ko:'매핑',en:'Mapping'},color:'#f97316'},{id:'covering',name:{ko:'커버링',en:'Covering'},color:'#eab308'},{id:'history',name:{ko:'히스토리',en:'History'},color:'#8b5cf6'},{id:'code',name:{ko:'코드',en:'Code'},color:'#14b8a6'},{id:'log',name:{ko:'로그',en:'Log'},color:'#64748b'},{id:'custom',name:{ko:'커스텀',en:'Custom'},color:'#3b82f6'}]);
    const entities=ref([
      {id:1,name:'User',x:50,y:50,entityType:'parent',color:'#6366f1',description:'',attributes:[{id:1,name:'id',type:'INT',length:'',pk:true,fk:false,nn:true,unique:false,unsigned:true,autoIncrement:true,defaultValue:'',charset:'',comment:'',fkRef:{table:'',column:''}},{id:2,name:'username',type:'VARCHAR',length:'50',pk:false,fk:false,nn:true,unique:true,unsigned:false,autoIncrement:false,defaultValue:'',charset:'utf8mb4',comment:'',fkRef:{table:'',column:''}},{id:3,name:'email',type:'VARCHAR',length:'255',pk:false,fk:false,nn:true,unique:true,unsigned:false,autoIncrement:false,defaultValue:'',charset:'',comment:'',fkRef:{table:'',column:''}}]},
      {id:2,name:'Post',x:380,y:50,entityType:'child',color:'#22c55e',description:'',attributes:[{id:4,name:'id',type:'BIGINT',length:'',pk:true,fk:false,nn:true,unique:false,unsigned:true,autoIncrement:true,defaultValue:'',charset:'',comment:'',fkRef:{table:'',column:''}},{id:5,name:'user_id',type:'INT',length:'',pk:false,fk:true,nn:true,unique:false,unsigned:true,autoIncrement:false,defaultValue:'',charset:'',comment:'',fkRef:{table:'User',column:'id'}},{id:6,name:'title',type:'VARCHAR',length:'200',pk:false,fk:false,nn:true,unique:false,unsigned:false,autoIncrement:false,defaultValue:'',charset:'',comment:'',fkRef:{table:'',column:''}}]}
    ]);
    const relations=ref([{id:1,from:1,to:2,cardinality:'1:N',label:'',fkColumn:'user_id',fkTargetEntityId:2}]);
    const selectedEntityId=ref(null),showSQL=ref(false),showBadges=ref(true),hoverAttr=ref(null),colorSettingsModal=ref(false);
    const entityModal=reactive({show:false,isEdit:false,editId:null,tab:'basic',data:{name:'',entityType:'parent',color:'#6366f1',description:''}});
    const pendingRelations=reactive({existing:[],toDelete:[],toAdd:[]});
    const newRel=reactive({direction:'to',targetId:'',cardinality:'1:N',label:'',fkColumnName:'',refColumn:'',fkNullable:false});
    const attrModal=reactive({show:false,entityId:null,attrId:null,data:{}});
    const sqlOptions=reactive({comments:true});
    const draggedEntity=ref(null),dragOffset=reactive({x:0,y:0}),canvas=ref(null);
    let nextId=100;
    const attrDrag=reactive({dragging:false,sourceEntityId:null,draggedAttrId:null,currentIndex:null});

    const getEntityName=id=>entities.value.find(e=>e.id===id)?.name||'';
    const getEntityNameSafe=id=>{if(id===entityModal.editId)return entityModal.data.name;return entities.value.find(e=>e.id===id)?.name||''};
    const getEntityTypeName=id=>{const tp=entityTypes.value.find(x=>x.id===id);return tp?tp.name[lang.value]:''};
    const getTypeDisplay=attr=>{let tp=attr.type;if(attr.length)tp+=`(${attr.length})`;return tp};

    const onAttrDragStart=(e,entityId,attrIdx,attrId)=>{
      attrDrag.dragging=true;attrDrag.sourceEntityId=entityId;attrDrag.draggedAttrId=attrId;attrDrag.currentIndex=attrIdx;
      e.dataTransfer.effectAllowed='move';e.dataTransfer.setData('text/plain',`${entityId}-${attrIdx}`);
      const dragImage=document.createElement('div');dragImage.style.opacity='0';document.body.appendChild(dragImage);
      e.dataTransfer.setDragImage(dragImage,0,0);setTimeout(()=>document.body.removeChild(dragImage),0);
    };
    const onAttrDragEnd=()=>{attrDrag.dragging=false;attrDrag.sourceEntityId=null;attrDrag.draggedAttrId=null;attrDrag.currentIndex=null};
    const onAttrDragOver=(e,entityId,attrIdx)=>{
      if(attrDrag.sourceEntityId!==entityId)return;e.preventDefault();e.dataTransfer.dropEffect='move';
      if(attrDrag.currentIndex===attrIdx)return;
      const entity=entities.value.find(en=>en.id===entityId);if(!entity)return;
      const fromIdx=attrDrag.currentIndex,toIdx=attrIdx,attrs=[...entity.attributes];
      const[movedItem]=attrs.splice(fromIdx,1);attrs.splice(toIdx,0,movedItem);
      entity.attributes=attrs;attrDrag.currentIndex=toIdx;
    };
    const onAttrDrop=(e)=>{e.preventDefault()};

    const openEntityModal=(entity=null)=>{resetNewRel();pendingRelations.toDelete=[];pendingRelations.toAdd=[];if(entity){entityModal.isEdit=true;entityModal.editId=entity.id;entityModal.tab='basic';entityModal.data={name:entity.name,entityType:entity.entityType,color:entity.color,description:entity.description||''};pendingRelations.existing=relations.value.filter(r=>r.from===entity.id||r.to===entity.id)}else{entityModal.isEdit=false;entityModal.editId=null;entityModal.tab='basic';const dt=entityTypes.value[0];entityModal.data={name:'',entityType:dt.id,color:dt.color,description:''};pendingRelations.existing=[]}entityModal.show=true};
    const closeEntityModal=()=>{if(hasPendingChanges()&&!confirm(lang.value==='ko'?'변경사항이 있습니다. 저장하지 않고 닫으시겠습니까?':'You have unsaved changes. Close anyway?'))return;entityModal.show=false};
    const resetNewRel=()=>{Object.assign(newRel,{direction:'to',targetId:'',cardinality:'1:N',label:'',fkColumnName:'',refColumn:'',fkNullable:false})};
    const selectEntityType=tp=>{entityModal.data.entityType=tp.id;entityModal.data.color=tp.color};
    const hasPendingChanges=()=>pendingRelations.toDelete.length>0||pendingRelations.toAdd.length>0;
    const markRelationForDelete=relId=>{if(!pendingRelations.toDelete.includes(relId))pendingRelations.toDelete.push(relId)};
    const unmarkRelationForDelete=relId=>{pendingRelations.toDelete=pendingRelations.toDelete.filter(id=>id!==relId)};
    const removePendingRelation=idx=>{pendingRelations.toAdd.splice(idx,1)};
    const getOtherEntities=()=>entities.value.filter(e=>e.id!==entityModal.editId);
    const getFkTargetEntityId=()=>{if(!newRel.targetId)return null;const card=newRel.cardinality;if(newRel.direction==='from')return(card==='1:N'||card==='1:1')?+newRel.targetId:entityModal.editId;return(card==='1:N'||card==='1:1')?entityModal.editId:+newRel.targetId};
    const getRefEntityId=()=>{if(!newRel.targetId)return null;const card=newRel.cardinality;if(newRel.direction==='from')return(card==='1:N'||card==='1:1')?entityModal.editId:+newRel.targetId;return(card==='1:N'||card==='1:1')?+newRel.targetId:entityModal.editId};
    const getFkTargetTableName=()=>{const id=getFkTargetEntityId();return id?getEntityNameSafe(id):''};
    const getRefTableName=()=>{const id=getRefEntityId();return id?getEntityNameSafe(id):''};
    const getRefColumns=()=>{const refId=getRefEntityId();if(!refId)return[];const e=entities.value.find(x=>x.id===refId);return e?e.attributes.filter(a=>a.pk||a.unique):[]};
    const getDefaultFkColumnName=()=>{const refId=getRefEntityId();if(!refId)return'';const refEntity=entities.value.find(e=>e.id===refId);if(!refEntity)return'';const pk=refEntity.attributes.find(a=>a.pk);return pk?`${refEntity.name.toLowerCase()}_${pk.name}`:''};
    const onTargetChange=()=>{newRel.fkColumnName='';const cols=getRefColumns();newRel.refColumn=cols.length?cols[0].name:''};
    const addPendingRelation=()=>{if(!newRel.targetId||!newRel.refColumn)return;const fromId=newRel.direction==='from'?entityModal.editId:+newRel.targetId,toId=newRel.direction==='from'?+newRel.targetId:entityModal.editId;const existsInCurrent=pendingRelations.existing.some(r=>!pendingRelations.toDelete.includes(r.id)&&((r.from===fromId&&r.to===toId)||(r.from===toId&&r.to===fromId)));const existsInPending=pendingRelations.toAdd.some(r=>(r.fromId===fromId&&r.toId===toId)||(r.fromId===toId&&r.toId===fromId));if(existsInCurrent||existsInPending){alert(lang.value==='ko'?'이미 관계가 존재합니다':'Relation already exists');return}const fkTargetId=getFkTargetEntityId(),refId=getRefEntityId(),refEntity=entities.value.find(e=>e.id===refId),refCol=refEntity?.attributes.find(a=>a.name===newRel.refColumn);pendingRelations.toAdd.push({fromId,toId,cardinality:newRel.cardinality,label:newRel.label,fkTargetEntityId:fkTargetId,fkColumnName:newRel.fkColumnName||getDefaultFkColumnName(),fkColumnType:refCol?.type||'INT',fkColumnLength:refCol?.length||'',fkColumnUnsigned:refCol?.unsigned||false,refTable:refEntity?.name||'',refColumn:newRel.refColumn,fkNullable:newRel.fkNullable});resetNewRel()};
    const saveEntity=()=>{if(!entityModal.data.name.trim()){alert(lang.value==='ko'?'엔티티명 필요':'Entity name required');return}if(entityModal.isEdit){const e=entities.value.find(x=>x.id===entityModal.editId);if(e){e.name=entityModal.data.name;e.entityType=entityModal.data.entityType;e.color=entityModal.data.color;e.description=entityModal.data.description}pendingRelations.toDelete.forEach(relId=>{const rel=relations.value.find(r=>r.id===relId);if(rel&&rel.fkColumn&&rel.fkTargetEntityId){const targetEntity=entities.value.find(e=>e.id===rel.fkTargetEntityId);if(targetEntity)targetEntity.attributes=targetEntity.attributes.filter(a=>a.name!==rel.fkColumn)}relations.value=relations.value.filter(r=>r.id!==relId)});pendingRelations.toAdd.forEach(rel=>{const fkTargetEntity=entities.value.find(e=>e.id===rel.fkTargetEntityId);if(fkTargetEntity){fkTargetEntity.attributes.push({id:nextId++,name:rel.fkColumnName,type:rel.fkColumnType,length:rel.fkColumnLength,pk:false,fk:true,nn:!rel.fkNullable,unique:false,unsigned:rel.fkColumnUnsigned,autoIncrement:false,defaultValue:'',charset:'',comment:'',fkRef:{table:rel.refTable,column:rel.refColumn}})}relations.value.push({id:nextId++,from:rel.fromId,to:rel.toId,cardinality:rel.cardinality,label:rel.label,fkColumn:rel.fkColumnName,fkTargetEntityId:rel.fkTargetEntityId})})}else{entities.value.push({id:nextId++,name:entityModal.data.name,x:50+(entities.value.length%3)*280,y:50+Math.floor(entities.value.length/3)*220,entityType:entityModal.data.entityType,color:entityModal.data.color,description:entityModal.data.description,attributes:[{id:nextId++,name:'id',type:'INT',length:'',pk:true,fk:false,nn:true,unique:false,unsigned:true,autoIncrement:true,defaultValue:'',charset:'',comment:'',fkRef:{table:'',column:''}}]})}entityModal.show=false};
    const deleteEntity=id=>{entities.value=entities.value.filter(e=>e.id!==id);relations.value=relations.value.filter(r=>r.from!==id&&r.to!==id)};
    const deleteEntityFromModal=()=>{if(confirm(lang.value==='ko'?'엔티티를 삭제하시겠습니까?':'Delete this entity?')){deleteEntity(entityModal.editId);entityModal.show=false}};
    const addAttr=eid=>{const e=entities.value.find(x=>x.id===eid);if(e){const na={id:nextId++,name:'new_col',type:'VARCHAR',length:'255',pk:false,fk:false,nn:false,unique:false,unsigned:false,autoIncrement:false,defaultValue:'',charset:'',comment:'',fkRef:{table:'',column:''}};e.attributes.push(na);openAttrModal(eid,na)}};
    const deleteAttr=(eid,aid)=>{const e=entities.value.find(x=>x.id===eid);if(e)e.attributes=e.attributes.filter(a=>a.id!==aid)};
    const openAttrModal=(eid,attr)=>{attrModal.entityId=eid;attrModal.attrId=attr.id;attrModal.data={...attr,fkRef:{...attr.fkRef}};attrModal.show=true};
    const saveAttr=()=>{const e=entities.value.find(x=>x.id===attrModal.entityId);if(e){const idx=e.attributes.findIndex(a=>a.id===attrModal.attrId);if(idx>-1)e.attributes[idx]={...attrModal.data}}attrModal.show=false};
    const deleteAttrFromModal=()=>{deleteAttr(attrModal.entityId,attrModal.attrId);attrModal.show=false};
    const getFkRefColumns=()=>{if(!attrModal.data.fkRef?.table)return[];const e=entities.value.find(x=>x.name===attrModal.data.fkRef.table);return e?e.attributes:[]};
    const onMouseDown=(e,entity)=>{const r=canvas.value.getBoundingClientRect();draggedEntity.value=entity.id;dragOffset.x=e.clientX-r.left-entity.x;dragOffset.y=e.clientY-r.top-entity.y};
    const onMouseMove=e=>{if(!draggedEntity.value||!canvas.value)return;const r=canvas.value.getBoundingClientRect();const ent=entities.value.find(en=>en.id===draggedEntity.value);if(ent){ent.x=Math.max(0,e.clientX-r.left-dragOffset.x);ent.y=Math.max(0,e.clientY-r.top-dragOffset.y)}};
    const onMouseUp=()=>{draggedEntity.value=null};
    const getRelationPath=rel=>{const f=entities.value.find(e=>e.id===rel.from),t=entities.value.find(e=>e.id===rel.to);if(!f||!t)return'';const fx=f.x+240,fy=f.y+50,tx=t.x,ty=t.y+50,mx=(fx+tx)/2;return`M${fx},${fy} C${mx},${fy} ${mx},${ty} ${tx},${ty}`};
    const getRelMid=rel=>{const f=entities.value.find(e=>e.id===rel.from),t=entities.value.find(e=>e.id===rel.to);return f&&t?{x:(f.x+240+t.x)/2,y:(f.y+50+t.y+50)/2}:{x:0,y:0}};
    const getCrowsFoot=(rel,side)=>{const f=entities.value.find(e=>e.id===rel.from),t=entities.value.find(e=>e.id===rel.to);if(!f||!t)return[];const[fc,tc]=rel.cardinality.split(':'),sz=10,paths=[];if(side==='from'){const x=f.x+240,y=f.y+50;if(fc==='N'||fc==='M')paths.push(`M${x},${y} L${x+sz},${y-sz/2}`,`M${x},${y} L${x+sz},${y+sz/2}`,`M${x},${y} L${x+sz},${y}`);else paths.push(`M${x+5},${y-6} L${x+5},${y+6}`)}else{const x=t.x,y=t.y+50;if(tc==='N'||tc==='M')paths.push(`M${x},${y} L${x-sz},${y-sz/2}`,`M${x},${y} L${x-sz},${y+sz/2}`,`M${x},${y} L${x-sz},${y}`);else paths.push(`M${x-5},${y-6} L${x-5},${y+6}`)}return paths};
    const generatedSQL=computed(()=>{let sql=`-- ERD Builder Pro\n\n`;entities.value.forEach(entity=>{sql+=`CREATE TABLE ${entity.name} (\n`;const cols=entity.attributes.map(a=>{let c=`  ${a.name} ${a.type}`;if(a.length)c+=`(${a.length})`;if(a.unsigned)c+=' UNSIGNED';if(a.charset)c+=` CHARACTER SET ${a.charset}`;if(a.nn)c+=' NOT NULL';else if(!a.pk)c+=' NULL';if(a.defaultValue)c+=` DEFAULT ${a.defaultValue.match(/^[0-9]|^NULL|^CURRENT/i)?a.defaultValue:`'${a.defaultValue}'`}`;if(a.autoIncrement)c+=' AUTO_INCREMENT';if(a.unique&&!a.pk)c+=' UNIQUE';if(sqlOptions.comments&&a.comment)c+=` COMMENT '${a.comment.replace(/'/g,"''")}'`;return c});const pks=entity.attributes.filter(a=>a.pk);if(pks.length)cols.push(`  PRIMARY KEY (${pks.map(p=>p.name).join(',')})`);entity.attributes.filter(a=>a.fk&&a.fkRef?.table&&a.fkRef?.column).forEach(a=>cols.push(`  FOREIGN KEY (${a.name}) REFERENCES ${a.fkRef.table}(${a.fkRef.column})`));sql+=cols.join(',\n')+'\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n'});return sql});
    const copySQL=()=>{navigator.clipboard.writeText(generatedSQL.value);alert(lang.value==='ko'?'복사됨!':'Copied!')};
    const downloadSQL=()=>{const b=new Blob([generatedSQL.value],{type:'text/plain'}),u=URL.createObjectURL(b),a=document.createElement('a');a.href=u;a.download='schema.sql';a.click()};

    return{lang,t,colorPalette,entityTypes,entities,relations,selectedEntityId,showSQL,showBadges,hoverAttr,colorSettingsModal,entityModal,pendingRelations,newRel,attrModal,sqlOptions,canvas,attrDrag,getEntityName,getEntityNameSafe,getEntityTypeName,getTypeDisplay,openEntityModal,closeEntityModal,selectEntityType,hasPendingChanges,markRelationForDelete,unmarkRelationForDelete,removePendingRelation,getOtherEntities,getFkTargetTableName,getRefTableName,getRefColumns,getDefaultFkColumnName,onTargetChange,addPendingRelation,saveEntity,deleteEntity,deleteEntityFromModal,addAttr,deleteAttr,openAttrModal,saveAttr,deleteAttrFromModal,getFkRefColumns,onMouseDown,onMouseMove,onMouseUp,getRelationPath,getRelMid,getCrowsFoot,generatedSQL,copySQL,downloadSQL,onAttrDragStart,onAttrDragEnd,onAttrDragOver,onAttrDrop};
  }
}).mount('#app');
</script>
</body>
</html>
